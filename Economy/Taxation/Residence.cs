using System.Collections;
using System.Collections.Generic;
using UnityEngine;

// ============================================================================
// –°–ò–°–¢–ï–ú–ê –ü–û–¢–†–ï–ë–ù–û–°–¢–ï–ô RESIDENCE (–ü–æ —Ç–∏–ø—É Anno 1800)
// ============================================================================
//
// –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
// 1. –ö–∞–∂–¥—ã–π –¥–æ–º (Residence) –∏–º–µ–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (basicNeeds)
// 2. –ö–∞–∂–¥–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å (Need) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Inspector:
//    - –°–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω—É–∂–Ω–æ –≤ –º–∏–Ω—É—Ç—É
//    - –°–∫–æ–ª—å–∫–æ –∂–∏—Ç–µ–ª–µ–π –¥–∞–µ—Ç –ø—Ä–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–∏
//    - –°–∫–æ–ª—å–∫–æ —Å—á–∞—Å—Ç—å—è –¥–∞–µ—Ç/–∑–∞–±–∏—Ä–∞–µ—Ç
//    - –°–∫–æ–ª—å–∫–æ –Ω–∞–ª–æ–≥–∞ –¥–∞–µ—Ç
// 3. –ö–∞–∂–¥—ã–µ X —Å–µ–∫—É–Ω–¥ (consumptionIntervalSeconds) –¥–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
// 4. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∞ ‚Üí –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ë–û–ù–£–°–´
//    –ï—Å–ª–∏ –ù–ï —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∞ ‚Üí –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –®–¢–†–ê–§–´
//
// ============================================================================
// –ü–†–ò–ú–ï–† –ù–ê–°–¢–†–û–ô–ö–ò –í UNITY:
// ============================================================================
//
// --- Residence (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ –¥–æ–º–µ) ---
// populationTier = Farmers
// housingCapacity = 10                    // –ú–∞–∫—Å–∏–º—É–º 10 –∂–∏—Ç–µ–ª–µ–π
// consumptionIntervalSeconds = 10         // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
// baseTaxAmount = 1.0                     // –ë–∞–∑–æ–≤—ã–π –Ω–∞–ª–æ–≥ (–≤—Å–µ–≥–¥–∞ –ø–ª–∞—Ç–∏—Ç—Å—è)
//
// basicNeeds (—Å–ø–∏—Å–æ–∫):
//   [0] –†—ã–±–∞ (–±–∞–∑–æ–≤–∞—è –µ–¥–∞) - –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ä–∞–∑—É:
//       resourceType = Fish
//       amountPerMinute = 0.1            // 10 –¥–æ–º–æ–≤ = 1 —Ä—ã–±–∞/–º–∏–Ω
//       populationBonus = 5              // +5 –∂–∏—Ç–µ–ª–µ–π
//       happinessBonus = 0.5             // +0.5 —Å—á–∞—Å—Ç—å—è
//       taxBonusPerCycle = 0.5           // +0.5 –∑–æ–ª–æ—Ç–∞
//       happinessPenalty = -1.0          // -1.0 —Å—á–∞—Å—Ç—å—è (–≥–æ–ª–æ–¥ –∫—Ä–∏—Ç–∏—á–µ–Ω!)
//       requiresUnlock = false           // ‚úì –î–æ—Å—Ç—É–ø–Ω–∞ —Å—Ä–∞–∑—É
//
//   [1] –û–¥–µ–∂–¥–∞ (–∫–æ–º—Ñ–æ—Ä—Ç) - —Ç—Ä–µ–±—É–µ—Ç 50 —Å–º–µ—Ä–¥–æ–≤:
//       resourceType = Clothes
//       amountPerMinute = 0.05           // 20 –¥–æ–º–æ–≤ = 1 –æ–¥–µ–∂–¥–∞/–º–∏–Ω
//       populationBonus = 3              // +3 –∂–∏—Ç–µ–ª—è
//       happinessBonus = 0.3             // +0.3 —Å—á–∞—Å—Ç—å—è
//       taxBonusPerCycle = 1.0           // +1.0 –∑–æ–ª–æ—Ç–∞
//       happinessPenalty = -0.5          // -0.5 —Å—á–∞—Å—Ç—å—è
//       requiresUnlock = true            // –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏!
//       unlockPopulationTier = Farmers   // –ù—É–∂–Ω—ã —Å–º–µ—Ä–¥—ã
//       unlockAtPopulation = 50          // –ú–∏–Ω–∏–º—É–º 50 —Å–º–µ—Ä–¥–æ–≤
//
//   [2] –ü–∏–≤–æ (—Ä–æ—Å–∫–æ—à—å) - —Ç—Ä–µ–±—É–µ—Ç 100 –ø–æ—Å–∞–¥—Å–∫–∏—Ö:
//       resourceType = Beer
//       amountPerMinute = 0.033          // 30 –¥–æ–º–æ–≤ = 1 –ø–∏–≤–æ/–º–∏–Ω
//       populationBonus = 2              // +2 –∂–∏—Ç–µ–ª—è
//       happinessBonus = 0.2             // +0.2 —Å—á–∞—Å—Ç—å—è
//       taxBonusPerCycle = 2.0           // +2.0 –∑–æ–ª–æ—Ç–∞
//       happinessPenalty = -0.2          // -0.2 —Å—á–∞—Å—Ç—å—è
//       requiresUnlock = true            // –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏!
//       unlockPopulationTier = Craftsmen // –ù—É–∂–Ω—ã –ø–æ—Å–∞–¥—Å–∫–∏–µ
//       unlockAtPopulation = 100         // –ú–∏–Ω–∏–º—É–º 100 –ø–æ—Å–∞–¥—Å–∫–∏—Ö
//
// --- –†–ï–ó–£–õ–¨–¢–ê–¢–´ (–ø—Ä–∏ –≤—Å–µ—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã) ---
// –ñ–∏—Ç–µ–ª–∏: 5 + 3 + 2 = 10 (–ª–∏–º–∏—Ç housingCapacity)
// –°—á–∞—Å—Ç—å–µ –∑–∞ —Ü–∏–∫–ª: +0.5 + 0.3 + 0.2 = +1.0
// –ù–∞–ª–æ–≥ –∑–∞ —Ü–∏–∫–ª: 1.0 (–±–∞–∑–æ–≤—ã–π) + 0.5 + 1.0 + 2.0 = 4.5 –∑–æ–ª–æ—Ç–∞
//
// --- –†–ï–ó–£–õ–¨–¢–ê–¢–´ (—Ç–æ–ª—å–∫–æ –†—ã–±–∞, –±–µ–∑ –û–¥–µ–∂–¥—ã –∏ –ü–∏–≤–∞) ---
// –ñ–∏—Ç–µ–ª–∏: 5 (—Ç–æ–ª—å–∫–æ –±–æ–Ω—É—Å –æ—Ç –†—ã–±—ã)
// –°—á–∞—Å—Ç—å–µ –∑–∞ —Ü–∏–∫–ª: +0.5 (–†—ã–±–∞) -0.5 (–Ω–µ—Ç –û–¥–µ–∂–¥—ã) -0.2 (–Ω–µ—Ç –ü–∏–≤–∞) = -0.2
// –ù–∞–ª–æ–≥ –∑–∞ —Ü–∏–∫–ª: 1.0 (–±–∞–∑–æ–≤—ã–π) + 0.5 (–†—ã–±–∞) = 1.5 –∑–æ–ª–æ—Ç–∞
//
// ============================================================================
// –§–û–†–ú–£–õ–ê: "X –¥–æ–º–æ–≤ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç Y —Ä–µ—Å—É—Ä—Å–∞ –≤ –º–∏–Ω—É—Ç—É"
// ============================================================================
//
// –•–æ—Ç–∏—Ç–µ: "10 –¥–æ–º–æ–≤ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç 1 –†—ã–±—É –≤ –º–∏–Ω—É—Ç—É"
// –†–µ—à–µ–Ω–∏–µ: amountPerMinute = 1.0 √∑ 10 = 0.1 (–Ω–∞ –û–î–ò–ù –¥–æ–º)
//
// –•–æ—Ç–∏—Ç–µ: "20 –¥–æ–º–æ–≤ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç 1 –û–¥–µ–∂–¥—É –≤ –º–∏–Ω—É—Ç—É"
// –†–µ—à–µ–Ω–∏–µ: amountPerMinute = 1.0 √∑ 20 = 0.05 (–Ω–∞ –û–î–ò–ù –¥–æ–º)
//
// –•–æ—Ç–∏—Ç–µ: "30 –¥–æ–º–æ–≤ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç 1 –ü–∏–≤–æ –≤ –º–∏–Ω—É—Ç—É"
// –†–µ—à–µ–Ω–∏–µ: amountPerMinute = 1.0 √∑ 30 = 0.033 (–Ω–∞ –û–î–ò–ù –¥–æ–º)
//
// ============================================================================
// –ü–û–ù–ò–ú–ê–ù–ò–ï consumptionIntervalSeconds vs amountPerMinute
// ============================================================================
//
// consumptionIntervalSeconds - –ö–ê–ö –ß–ê–°–¢–û –ø—Ä–æ–≤–µ—Ä—è–µ–º (10 —Å–µ–∫ = 6 —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É)
// amountPerMinute - –°–ö–û–õ–¨–ö–û –í–°–ï–ì–û –Ω—É–∂–Ω–æ –∑–∞ 1 –º–∏–Ω—É—Ç—É
//
// –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:
//   amountToConsume = amountPerMinute √ó (consumptionIntervalSeconds √∑ 60)
//
// –ü—Ä–∏–º–µ—Ä (consumptionIntervalSeconds = 10, amountPerMinute = 0.1):
//   –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥: 0.1 √ó (10 √∑ 60) = 0.1 √ó 0.1667 = 0.01667 —Ä—ã–±—ã
//   –ó–∞ –º–∏–Ω—É—Ç—É (6 –ø—Ä–æ–≤–µ—Ä–æ–∫): 0.01667 √ó 6 = 0.1 —Ä—ã–±—ã ‚úì
//
// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –û—Å—Ç–∞–≤–∏—Ç—å consumptionIntervalSeconds = 10 (—É–¥–æ–±–Ω—ã–π –±–∞–ª–∞–Ω—Å)
//              –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ amountPerMinute
//
// ============================================================================
// –ú–ï–•–ê–ù–ò–ö–ê –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ò –ü–û–¢–†–ï–ë–ù–û–°–¢–ï–ô (Anno 1800 Progression)
// ============================================================================
//
// –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–´ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è.
// –ü–æ–∫–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞:
//   ‚Ä¢ –ù–ï –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è (—Ä–µ—Å—É—Ä—Å –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è)
//   ‚Ä¢ –ù–ï –¥–∞–µ—Ç –±–æ–Ω—É—Å—ã (–Ω–∞—Å–µ–ª–µ–Ω–∏–µ, —Å—á–∞—Å—Ç—å–µ, –Ω–∞–ª–æ–≥–∏)
//   ‚Ä¢ –ù–ï –¥–∞–µ—Ç —à—Ç—Ä–∞—Ñ—ã (–Ω–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–∞ –æ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è)
//   ‚Ä¢ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π
//
// –ü–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–¥–æ—Å—Ç–∏–≥–ª–∏ –Ω—É–∂–Ω–æ–≥–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è):
//   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
//   ‚Ä¢ –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ –±–æ–Ω—É—Å—ã/—à—Ç—Ä–∞—Ñ—ã
//
// –ü–†–ò–ú–ï–† –ü–†–û–ì–†–ï–°–°–ò–ò:
//   –°—Ç–∞—Ä—Ç ‚Üí 0 –∂–∏—Ç–µ–ª–µ–π
//   ‚Üì
//   –°—Ç—Ä–æ–∏–º –¥–æ–º–∞ —Å–º–µ—Ä–¥–æ–≤ ‚Üí –†—ã–±–∞ (requiresUnlock = false) ‚Üí +5 –∂–∏—Ç–µ–ª–µ–π/–¥–æ–º
//   ‚Üì
//   –î–æ—Å—Ç–∏–≥–ª–∏ 50 —Å–º–µ—Ä–¥–æ–≤
//   ‚Üì
//   –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê: –û–¥–µ–∂–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç Farmers >= 50) ‚Üí +3 –∂–∏—Ç–µ–ª—è/–¥–æ–º
//   ‚Üì
//   –î–æ—Å—Ç–∏–≥–ª–∏ 100 –ø–æ—Å–∞–¥—Å–∫–∏—Ö
//   ‚Üì
//   –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê: –ü–∏–≤–æ (—Ç—Ä–µ–±—É–µ—Ç Craftsmen >= 100) ‚Üí +2 –∂–∏—Ç–µ–ª—è/–¥–æ–º
//
// ============================================================================

/// <summary>
/// (–ù–æ–≤—ã–π struct) –í—Ä–µ–º–µ–Ω–Ω—ã–π "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä" –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ 1 –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏.
/// </summary>
public struct NeedResult
{
    public Need need;  // –°—Å—ã–ª–∫–∞ –Ω–∞ "–Ω–∞—Å—Ç—Ä–æ–π–∫–∏" –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (–æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –±–æ–Ω—É—Å—ã)
    public bool isMet; // –†–µ–∑—É–ª—å—Ç–∞—Ç (–î–∞/–ù–µ—Ç)
}


[RequireComponent(typeof(BuildingIdentity))]
public class Residence : MonoBehaviour
{
    [Header("=== –£—Ä–æ–≤–µ–Ω—å –î–æ–º–∞ ===")]
    [Tooltip("–£—Ä–æ–≤–µ–Ω—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è (Farmers/Craftsmen/Artisans)")]
    public PopulationTier populationTier = PopulationTier.Farmers;

    [Tooltip("–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–æ–º–∞\n\n" +
             "–í–ê–ñ–ù–û: –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π = —Å—É–º–º–∞ populationBonus –∏–∑ –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ù–´–• –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π\n" +
             "–≠—Ç–æ –ø–æ–ª–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º (–Ω–µ–ª—å–∑—è –ø—Ä–µ–≤—ã—Å–∏—Ç—å —ç—Ç–æ—Ç –ª–∏–º–∏—Ç)")]
    public int housingCapacity = 10;

    [Header("=== –°–∏—Å—Ç–µ–º–∞ –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (Anno 1800) ===")]
    [Tooltip("–°–ø–∏—Å–æ–∫ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –¥–æ–º–∞ (–†—ã–±–∞, –û–¥–µ–∂–¥–∞, –ü–∏–≤–æ –∏ —Ç.–¥.)\n\n" +
             "–ö–∞–∂–¥–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ:\n" +
             "  ‚Ä¢ –°–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω—É–∂–Ω–æ –≤ –º–∏–Ω—É—Ç—É\n" +
             "  ‚Ä¢ –°–∫–æ–ª—å–∫–æ –∂–∏—Ç–µ–ª–µ–π –¥–∞–µ—Ç (populationBonus)\n" +
             "  ‚Ä¢ –ë–æ–Ω—É—Å—ã –∫ —Å—á–∞—Å—Ç—å—é –∏ –Ω–∞–ª–æ–≥–∞–º\n\n" +
             "–°–º. –ø—Ä–∏–º–µ—Ä—ã –≤ Need.cs –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—ã—à–µ")]
    public List<Need> basicNeeds;

    [Tooltip("–ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)\n\n" +
             "–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: 10 —Å–µ–∫—É–Ω–¥ (6 –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –º–∏–Ω—É—Ç—É)\n" +
             "–£–º–µ–Ω—å—à–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ! –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ amountPerMinute –≤ –∫–∞–∂–¥–æ–π Need")]
    public float consumptionIntervalSeconds = 10f;

    [Header("=== –ù–∞–ª–æ–≥–∏ ===")]
    [Tooltip("–ë–ê–ó–û–í–´–ô –Ω–∞–ª–æ–≥ (–ø–ª–∞—Ç–∏—Ç—Å—è –í–°–ï–ì–î–ê, –¥–∞–∂–µ –ø—Ä–∏ –≥–æ–ª–æ–¥–µ)\n\n" +
             "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–ª–æ–≥–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (Need.taxBonusPerCycle)\n\n" +
             "–ò—Ç–æ–≥–æ–≤—ã–π –Ω–∞–ª–æ–≥ = baseTaxAmount + —Å—É–º–º–∞ taxBonusPerCycle –∏–∑ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π")]
    public float baseTaxAmount = 1f;
    
    // (–£–±—Ä–∞–Ω—ã 'happinessGain' –∏ 'happinessPenalty', —Ç.–∫. –æ–Ω–∏ —Ç–µ–ø–µ—Ä—å –≤ Need.cs)

    // --- –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—ã ---
    private BuildingIdentity _identity;
    private AuraManager _auraManager;
    private ResourceManager _resourceManager;
    private TaxManager _taxManager;
    private HappinessManager _happinessManager;
    // –£–î–ê–õ–ï–ù–û: PopulationManager —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ ResourceManager.Instance.Population

    // –¢–µ–∫—É—â–∏–π –Ω–∞–ª–æ–≥ (–¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ TaxManager)
    private float _currentTax;

    // –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π)
    private int _currentResidents = 0;

    // –ü—Ä–æ—Ü–µ–Ω—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (0.0 - 1.0)
    private float _needsSatisfactionRate = 1.0f;

    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–æ–±—ã—Ç–∏—è–º–∏)
    private List<NeedResult> _lastNeedResults = new List<NeedResult>();

    // üî• FIX: –•—Ä–∞–Ω–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ—Ä—É—Ç–∏–Ω—É
    private Coroutine _consumeNeedsCoroutine;

    private void Start()
    {
        // (–ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        _identity = GetComponent<BuildingIdentity>();
        _auraManager = AuraManager.Instance;
        _resourceManager = ResourceManager.Instance;
        _taxManager = TaxManager.Instance;
        _happinessManager = HappinessManager.Instance;

        if (_auraManager == null || _resourceManager == null || _taxManager == null || _happinessManager == null || _resourceManager.Population == null)
        {
            Debug.LogError($"[Residence] –Ω–∞ {gameObject.name} –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ –æ–¥–∏–Ω –∏–∑ '–º–æ–∑–≥–æ–≤' (Managers). –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å–ª–æ–º–∞–Ω–∞.");
            this.enabled = false;
            return;
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∂–∏–ª—å–µ –≤ Population (—Ç–µ–ø–µ—Ä—å –≤ ResourceManager)
        if (!_identity.isBlueprint)
        {
            _resourceManager.Population.AddHousingCapacity(populationTier, housingCapacity);
            Debug.Log($"[Residence] {gameObject.name} –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Population: {populationTier}, –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {housingCapacity}");
        }

        // FIX #11: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –≤ BuildingRegistry –¥–ª—è TaxManager
        if (BuildingRegistry.Instance != null && !_identity.isBlueprint)
        {
            BuildingRegistry.Instance.RegisterResidence(this);
        }

        _consumeNeedsCoroutine = StartCoroutine(ConsumeNeedsCoroutine());
    }

    private void OnDestroy()
    {
        // –°–Ω–∏–º–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∂–∏–ª—å—è –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏
        if (_resourceManager != null && _resourceManager.Population != null && !_identity.isBlueprint)
        {
            _resourceManager.Population.RemoveHousingCapacity(populationTier, housingCapacity);
            Debug.Log($"[Residence] {gameObject.name} —Å–Ω—è—Ç —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑ Population");
        }

        // FIX #11: –†–∞–∑—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –∏–∑ BuildingRegistry
        if (BuildingRegistry.Instance != null && _identity != null && !_identity.isBlueprint)
        {
            BuildingRegistry.Instance.UnregisterResidence(this);
        }

        // üî• FIX: Memory leak - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ—Ä—É—Ç–∏–Ω—É –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏
        if (_consumeNeedsCoroutine != null)
        {
            StopCoroutine(_consumeNeedsCoroutine);
            _consumeNeedsCoroutine = null;
        }
    }

    /// <summary>
    /// –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –∂–∏–∑–Ω–∏ –¥–æ–º–∞.
    /// </summary>
    private IEnumerator ConsumeNeedsCoroutine()
    {
        while (true)
        {
            yield return new WaitForSeconds(consumptionIntervalSeconds);

            if (_identity.isBlueprint)
            {
                continue; // "–ü—Ä–æ–µ–∫—Ç—ã" –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç
            }

            // --- –õ–û–ì–ò–ö–ê 3.0: –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ---
            
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –ê—É—Ä–µ (–°–µ—Ä–≤–∏—Å—ã)
            bool hasMarket = CheckServiceNeeds();
            
            // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ "—Å—ä–µ–¥–∞–µ–º" –†–µ—Å—É—Ä—Å—ã (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –†—ã–Ω–∫—É)
            List<NeedResult> resourceResults;
            if (hasMarket)
            {
                // –ï—Å–ª–∏ —Ä—ã–Ω–æ–∫ –µ—Å—Ç—å - –ø—ã—Ç–∞–µ–º—Å—è "–∫—É–ø–∏—Ç—å" (—Å–ø–∏—Å–∞—Ç—å)
                resourceResults = CheckAndConsumeResourceNeeds();
            }
            else
            {
                // –ï—Å–ª–∏ —Ä—ã–Ω–∫–∞ –Ω–µ—Ç - "–ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ–º" –í–°–ï –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
                resourceResults = FailAllResourceNeeds();
            }

            // 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–°—á–∞—Å—Ç—å–µ –∏ –ù–∞–ª–æ–≥–∏)
            ProcessResults(resourceResults);
            
            // --- –ö–û–ù–ï–¶ –õ–û–ì–ò–ö–ò 3.0 ---
        }
    }

    /// <summary>
    /// (–®–∞–≥ –ê) –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ "—Å–µ—Ä–≤–∏—Å–Ω—ã–º" –∑–¥–∞–Ω–∏—è–º (–†—ã–Ω–æ–∫).
    /// </summary>
    private bool CheckServiceNeeds()
    {
        // (–ü–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –†—ã–Ω–æ–∫, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ)
        bool hasMarket = _auraManager.IsPositionInAura(transform.position, AuraType.Market);
        
        if (!hasMarket)
        {
            Debug.Log($"[Residence] {gameObject.name} –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –†—ã–Ω–∫—É!"); 
        }
        return hasMarket;
    }

    /// <summary>
    /// (–®–∞–≥ –ë - –£–°–ü–ï–•) –ü—ã—Ç–∞–µ—Ç—Å—è "–∫—É–ø–∏—Ç—å" (—Å–ø–∏—Å–∞—Ç—å) —Ä–µ—Å—É—Ä—Å—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—á–µ—Ç.
    /// –ù–û–í–û–ï: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ï –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö)
    /// </summary>
    private List<NeedResult> CheckAndConsumeResourceNeeds()
    {
        float intervalAsFractionOfMinute = consumptionIntervalSeconds / 60f;
        var results = new List<NeedResult>();

        // --- "–ü–æ-–ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è" –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ï) ---
        results.Clear();
        foreach (var need in basicNeeds)
        {
            // ========== –ü–†–û–í–ï–†–ö–ê –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ò ==========
            if (!need.IsUnlocked())
            {
                // –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ results)
                // –û–Ω–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∏ –Ω–∞ —á—Ç–æ: –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è, –Ω–µ –¥–∞–µ—Ç –±–æ–Ω—É—Å—ã/—à—Ç—Ä–∞—Ñ—ã
                continue;
            }

            // –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
            float amountToConsume = need.amountPerMinute * intervalAsFractionOfMinute;

            // –ü—ã—Ç–∞–µ–º—Å—è "–∫—É–ø–∏—Ç—å" (—Å–ø–∏—Å–∞—Ç—å) –≠–¢–û–¢ –û–î–ò–ù –ø—Ä–µ–¥–º–µ—Ç
            bool success = _resourceManager.TakeFromStorage(need.resourceType, amountToConsume) > 0;

            results.Add(new NeedResult { need = need, isMet = success });

            if (!success)
                Debug.Log($"[Residence] {gameObject.name} –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ {need.resourceType}!");
        }

        return results;
    }

    /// <summary>
    /// (–®–∞–≥ –ë - –ü–†–û–í–ê–õ) "–ü—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç" –≤—Å–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (—Ç.–∫. –Ω–µ—Ç —Ä—ã–Ω–∫–∞).
    /// –ù–û–í–û–ï: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ï –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö)
    /// </summary>
    private List<NeedResult> FailAllResourceNeeds()
    {
        var results = new List<NeedResult>();
        foreach (var need in basicNeeds)
        {
            // ========== –ü–†–û–í–ï–†–ö–ê –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ò ==========
            if (!need.IsUnlocked())
            {
                // –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ results)
                continue;
            }

            // –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê - "–ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ–º" (–Ω–µ—Ç —Ä—ã–Ω–∫–∞)
            results.Add(new NeedResult { need = need, isMet = false });
        }
        return results;
    }

    /// <summary>
    /// (–®–∞–≥ –í) –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
    /// –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê (Anno 1800): –∫–∞–∂–¥–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –¥–∞–µ—Ç —Å–≤–æ–π –±–æ–Ω—É—Å –∫ –Ω–∞—Å–µ–ª–µ–Ω–∏—é, —Å—á–∞—Å—Ç—å—é, –Ω–∞–ª–æ–≥–∞–º
    /// </summary>
    private void ProcessResults(List<NeedResult> resourceResults)
    {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–æ–±—ã—Ç–∏—è–º–∏
        _lastNeedResults = new List<NeedResult>(resourceResults);

        float totalHappinessChange = 0;
        float totalTax = baseTaxAmount; // –ù–∞—á–∏–Ω–∞–µ–º —Å "–±–∞–∑–æ–≤–æ–≥–æ" –Ω–∞–ª–æ–≥–∞
        int totalPopulation = 0; // –ù–û–í–û–ï: —Å—É–º–º–∏—Ä—É–µ–º –∂–∏—Ç–µ–ª–µ–π –∏–∑ –∫–∞–∂–¥–æ–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏

        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
        int totalNeeds = resourceResults.Count;
        int satisfiedNeeds = 0;

        foreach (var result in resourceResults)
        {
            if (result.isMet)
            {
                satisfiedNeeds++;
                // ========== –£–°–ü–ï–•: –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ê ==========
                // (–Ω–∞–ø—Ä. "–†—ã–±–∞" –∫—É–ø–ª–µ–Ω–∞, "–û–¥–µ–∂–¥–∞" –≤ –Ω–∞–ª–∏—á–∏–∏)

                totalPopulation += result.need.populationBonus;  // +5 –∂–∏—Ç–µ–ª–µ–π –∑–∞ –†—ã–±—É, +3 –∑–∞ –û–¥–µ–∂–¥—É –∏ —Ç.–¥.
                totalHappinessChange += result.need.happinessBonus; // +0.5 —Å—á–∞—Å—Ç—å—è
                totalTax += result.need.taxBonusPerCycle; // +0.5 –∑–æ–ª–æ—Ç–∞ (–¥–æ–≤–æ–ª—å–Ω—ã–µ –ª—é–¥–∏ –ø–ª–∞—Ç—è—Ç –±–æ–ª—å—à–µ)
            }
            else
            {
                // ========== –ü–†–û–í–ê–õ: –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –ù–ï –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ê ==========
                // (–Ω–∞–ø—Ä. "–ù–µ—Ç –†—ã–±—ã" –∏–ª–∏ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –†—ã–Ω–∫—É")

                // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –∂–∏—Ç–µ–ª–µ–π (populationBonus –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
                totalHappinessChange += result.need.happinessPenalty; // -1.0 —Å—á–∞—Å—Ç—å—è (–≥–æ–ª–æ–¥!)
                // –ù–∞–ª–æ–≥ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π)
            }
        }

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏/UI)
        _needsSatisfactionRate = (totalNeeds > 0) ? ((float)satisfiedNeeds / (float)totalNeeds) : 1.0f;

        // –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –∂–∏—Ç–µ–ª–∏ = —Å—É–º–º–∞ populationBonus –∏–∑ –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ù–´–• –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π
        // –ü—Ä–∏–º–µ—Ä: –†—ã–±–∞ (+5) + –û–¥–µ–∂–¥–∞ (+3) = 8 –∂–∏—Ç–µ–ª–µ–π
        //         –¢–æ–ª—å–∫–æ –†—ã–±–∞ (+5) = 5 –∂–∏—Ç–µ–ª–µ–π
        //         –ù–∏—á–µ–≥–æ –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–æ = 0 –∂–∏—Ç–µ–ª–µ–π
        _currentResidents = Mathf.Min(totalPopulation, housingCapacity); // –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ–º –ª–∏–º–∏—Ç –¥–æ–º–∞

        // "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º" –∏—Ç–æ–≥–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
        _happinessManager.AddHappiness(totalHappinessChange);
        _currentTax = totalTax; // TaxManager –∑–∞–±–µ—Ä–µ—Ç –ø–ª–∞–≤–Ω–æ

        // –û–±–Ω–æ–≤–ª—è–µ–º PopulationManager –æ —Ç–µ–∫—É—â–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∂–∏—Ç–µ–ª–µ–π

        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        int lockedNeedsCount = 0;
        foreach (var need in basicNeeds)
        {
            if (!need.IsUnlocked())
                lockedNeedsCount++;
        }

        Debug.Log($"[Residence] {gameObject.name}: " +
                  $"–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏: {satisfiedNeeds}/{totalNeeds} ({_needsSatisfactionRate * 100f:F1}%), " +
                  $"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {lockedNeedsCount}, " +
                  $"–ñ–∏—Ç–µ–ª–µ–π: {_currentResidents}/{housingCapacity}, " +
                  $"–°—á–∞—Å—Ç—å–µ: {totalHappinessChange:+0.0;-0.0}, " +
                  $"–ù–∞–ª–æ–≥: {totalTax:F2}");
    }

    /// <summary>
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –Ω–∞–ª–æ–≥ —ç—Ç–æ–≥–æ –¥–æ–º–∞ (–¥–ª—è TaxManager).
    /// </summary>
    public float GetCurrentTax()
    {
        // –ï—Å–ª–∏ —ç—Ç–æ —á–µ—Ä—Ç–µ–∂, –Ω–∞–ª–æ–≥ = 0
        if (_identity != null && _identity.isBlueprint)
        {
            return 0;
        }

        return _currentTax;
    }

    /// <summary>
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —à–∞–Ω—Å–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –æ—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π
    /// (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è EventManager –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π)
    /// </summary>
    public float GetPandemicChanceReduction()
    {
        float totalReduction = 0f;

        foreach (var result in _lastNeedResults)
        {
            // –¢–æ–ª—å–∫–æ –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ù–´–ï –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–∞—é—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ —à–∞–Ω—Å–∞
            if (result.isMet)
            {
                totalReduction += result.need.pandemicChanceReduction;
            }
        }

        return Mathf.Clamp01(totalReduction);
    }

    /// <summary>
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —à–∞–Ω—Å–∞ –±—É–Ω—Ç–∞ –æ—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π
    /// (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è EventManager –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π)
    /// </summary>
    public float GetRiotChanceReduction()
    {
        float totalReduction = 0f;

        foreach (var result in _lastNeedResults)
        {
            // –¢–æ–ª—å–∫–æ –£–î–û–í–õ–ï–¢–í–û–†–ï–ù–ù–´–ï –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–∞—é—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ —à–∞–Ω—Å–∞
            if (result.isMet)
            {
                totalReduction += result.need.riotChanceReduction;
            }
        }

        return Mathf.Clamp01(totalReduction);
    }
}